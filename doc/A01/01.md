# Apache Wicket

Apache Wicket はサーバサイド型Webアプリケーション（特に、ブラウザに表示するHTMLやファイルを毎回サーバ側で生成するもの）の中で、要求の受付とHTMLの生成を担当するフレームワークである。

ここでは、Wicketの特徴としくみついて簡単に解説する。

またWicketを学ぶ・使う上で、筆者が考えるメリット・デメリットを説明する。

## Apache Wicket の登場と特徴

Webアプリケーションが一般に利用されるようになってから、サービスの高機能・高性能化・大規模化にあわせて、様々な技術的な革新が行われてきた。

特にシステム構成やアーキテクチャに関わる部分は大きく変化してきている。

ここでは、ざっくりと

1. 1990年終盤から2010年頃のモノシリック型
    - 大きなサーバにシステムを導入する単独のMVCシステム
2. 2010年前後からのシングルページアプリケーション型
    - クライアント（フロントエンドやスマホアプリ）とサーバ（バックエンド）の処理の分離・分散
3. 近年のマイクロサービス型
    - クラウド×分散システム化の集大成

という歴史にわけてみる。

### Wicketの登場

Wicketが生まれたのは 1 の半ばごろである。

この頃のJavaはWebアプリケーション開発の主力的な役割を持ち、さまざまな用途のWebアプリケーションにJavaが用いられていた。一方で、その用途にあわせて手法の複雑化も進んでしまい、従来型の手法では開発者にとって敷居が高い・労力が大きい・Javaの良いところが生かせない部分も出てきていた。（興味がある人は `xml hell` とかで調べてみるとよい）

こうした背景の中で、Wicketは、Webアプリケーションを「Javaらしく」開発できるように、というコンセプトの元で登場した。

### Wicketの特徴

Webアプリケーションを「Javaらしく」開発するために、Wicketが備えている主な特徴は、Wicketのホームページに記載されている。

ここではいくつかピックアップして説明する。

- HTMLをそのまま使える
- コンポーネント指向MVC
- Javaによるメンテナンス性
- ステートフル
- セキュリティ

**HTMLをそのまま使える** では、画面上に表示するHTMLは、特殊な技術や特別なタグを覚えなくても、通常のHTMLのまま利用できる。これにより、Javaの部分に集中して開発をできる。

**コンポーネント指向** では、画面上に表示する部品（HTMLの場合はタグ一つ一つやその動き）をそれぞれクラスとして作成する。この作り方はデスクトップやモバイルアプリの画面でよく使われている。<br>なお、特にMVCのうち、VCを担当する。

**Javaによるメンテナンス性** では、画面上のひとつひとつの部品がJavaクラスになるので、画面の動作や、画面やパーツがどういったデータを受け渡すのかをJavaプログラムで制御できる。本来は別にJavaScriptが必要な、画面上のリアルタイム性の高い処理もほとんどJavaだけで実現できる。

**ステートフル** では、画面上の状態をセッションで管理できる。これにより、ユーザーがどの画面をどの状態で表示しているかの制御が行いやすくなる。<br>（例：戻るボタンを押した時の制御を用意しなくてよい）

**セキュリティ** では、CSRFのような定番の攻撃について、標準で防御機能を備えている。

## Wicket のしくみ

サーバサイド型Webアプリケーションは、サーバーのアプリケーションが、ブラウザからの要求をHTMLファイルで返答するまでに関わるプログラムをModel, View, Controllerの3つのパートに分ける **Web-MVC** というパターンに則って作成する。

- **Model** に属するプログラムの主な役割
  - HTMLに表示するデータの生成や管理を行う
  - データ自体の管理を行う
  - データベースや外部データソースとのやりとりも行う
- **View** に属するプログラムの主な役割
  - Modelが作ったデータからHTMLを生成する
- **Controller** に属するプログラムの主な役割
  - ブラウザからの要求に応じて、指示するModelやViewを切り替える
  

本来は、このMVCの動作をすべて自分たちでプログラミングする必要があるが、ゼロからの作成は膨大な作業になる上、アプリケーション間で共有できる部分も多い。

そこで、Wicketの様なフレームワーク（アプリケーションを作るベースとなる土台、半製品）を利用する。

Wicketはとくに「コンポーネント指向MVC」という手法を提供するフレームワークで、**プレゼンテーション層とビジネスサービス層の呼び出し：つまりView・Controllerの部分と、Modelの呼び出し部分**までを手助けする。たとえばブラウザがあるURLを表示しようとしたときに、クライアントからの要求は何か（Controller）、どのビジネスサービスが画面用のデータを提供してくれるか（Modelの呼び出し）、画面をどのようなコンポーネントで作り、HTMLにマッピングするか（View）を実現できるようにしてくれる。

> ![General schema of page request handling for a component oriented framework](https://ci.apache.org/projects/wicket/guide/9.x/img/requesthandling-general.png)<br>
> コンポーネント試行フレームワークのページ表示までの標準的な流れ（[Wicket 9.x Reference Guide](https://ci.apache.org/projects/wicket/guide/9.x/single.html)より引用）<br>
> ブラウザの要求に応じて、フレームワークが表示するページの原型を作る<br>
> ページの原型に基づいて、HTMLファイルを作る<br>
> HTMLファイルをブラウザに返送する<br>

#### 補足

- 「イベント指向MVC」という手法もあり、そちらを採用するフレームワークもある（Spring MVCなど）。
- フロントエンドとバックエンドを分離する場合、ブラウザ上のScriptやアプリが全体的なView、サーバの役割はWeb-APIを作成するといったControllerとModelに特化するので、イベント指向形をベースにまた違った構成（MVVMなど）をとる。

## Wicket を学ぶ・使うメリットと注意点

Wicketは登場からかなりの時間も経過している。国外では、[メルセデスベンツなどの企業がWebサイトにWicketを採用する](https://twitter.com/apache_wicket/status/1050271799672483840)といった事例もあるが、現在、国内でメジャーな技術とはいえない。

そんな中でWicketを学ぶ・使うメリットを、筆者の視点でいくつか紹介する。

### メリット

- **コンポーネント指向を学べる**<br>コンポーネント指向の開発手法は、デスクトップアプリ・モバイルアプリ・フロントエンドでも広く使われている。画面パーツをクラスに置き換えて、パーツ同士を連携させる手法などは、他のコンポーネント指向開発にも通ずる。
- **JavaだけでWebアプリを構築できる**<br>Webアプリケーションを他の言語を使わずに実現できる。（限界はあるが）リアルタイム性の高いものも実現できる。基本的なセキュリティ確保手段もWicket側で用意されているので、はじめてWebアプリを作ってみる場合なども機能要件に集中して挑戦できる。
- （公立千歳科学技術大学では）**研究や試行のベース環境に使える**<br>学内には旧来からWicketで使られた教育ツールや支援ツールもまだ多い。これを基盤に使った研究や実験を行いたい場合や、小規模のWebアプリをJavaだけでさっと作って検証したい場合に有用である。

### 注意点

- **サーバーサイド型の構成はモダンではない**<br>とくに日本では、フロントエンドとバックエンドをWeb-API等で連携させるシステム構成が主流である。Wicketは現在の主流が本格化する前に活躍したもので、サーバサイドでHTMLを生成する（サーバサイドWebアプリケーション）構成である。たとえば卒業後に、Wicket自体を使う機会やプロダクトは残念ながら（国内であればなおのこと）ごくごく限られる。モダンなWebアプリケーションの開発手法を学びたい場合や、大規模利用者を想定した構成には必ずしもマッチしない。
- **日本語ドキュメントがごく少ない**
    - 日本語書籍は[矢野勉さんの"WicketによるWebアプリケーション開発"](https://www.amazon.co.jp/dp/4798022217)。バージョンは古いが、基本的な考え方・使い方は変わらない部分が多いので、可能であればバイブルとして手元に一冊おいておきたい。
    - 日本語ブログは [posturanさんの"Oboe吹きプログラマの黙示録"](http://oboe2uran.hatenablog.com/archive/category/Wicket)、[kemsakuraiさんの"monotalk"](https://www.monotalk.xyz/)が実験的なものも含めてノウハウもあり、ありがたい。
    - 最新版の情報は英語のドキュメント（[Introducing Apache Wicket](https://wicket.apache.org/learn/presentations/wicketIntroduction.pdf), [Wicket Reference Guide](https://ci.apache.org/projects/wicket/guide/9.x/single.html)）やニュースリリースを追っていく必要がある。<br>（ドキュメントの英語はそこまで難しくないので、英語ソースから情報を得る練習にはよい）
    - 開発陣のHowTo記事は ["Wicket In Action"](http://wicketinaction.com/) に載っているので、やりたいことにつながるヒントを得られる場合がある。

こうしたことからも、Wicketは、 **コンポーネント指向を学びたい場合** や、 **少ない技術（Java）だけで小規模利用者を想定したWebアプリケーションを作りたい場合** に有用である。

----

[目次へ](../../README.md) 
